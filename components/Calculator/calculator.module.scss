// components/Calculator/Calculator.module.scss
@use "../../styles/primitives" as p;

.wrapper {
  background-color: var(--c-bg);
  padding-block: var(--sp-6);
  padding-inline: var(--sp-3);

  @media (min-width: 768px) {
    padding-block: var(--sp-8);
    padding-inline: var(--sp-4);
  }
}

.form {
  max-width: 960px;
  margin-inline: auto;
  background-color: var(--c-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  padding: var(--sp-5);
  display: flex;
  flex-direction: column;
  gap: var(--sp-4);
  min-height: calc(100svh - var(--sticky-h) - var(--sp-4));

  @media (max-width: 767px) {
    padding: var(--sp-4) var(--sp-3) var(--sp-3);
    min-height: calc(100svh - var(--sticky-h));
  }
}

/* Steps */

.step {
  display: flex;
  flex-direction: column;
  gap: var(--sp-4);
}

.stepHeader {
  display: flex;
  align-items: center;
  gap: var(--sp-3);
}

.stepBadge {
  width: 2rem;
  height: 2rem;
  border-radius: 999px;
  background-color: var(--c-step-current-soft);
  color: var(--c-step-current);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: var(--fs-sm);
}

.stepTitle {
  margin: 0;
  font-size: var(--fs-2xl);
  font-weight: 600;
  line-height: var(--lh-tight);
  color: var(--c-primary-strong);
}

.stepBody {
  display: flex;
  flex-direction: column;
  gap: var(--sp-4);
}

/* Step transition */

.stepAnimated {
  opacity: 0;
  transform: translateY(6px);
  animation: stepIn 0.22s ease-out forwards;
}

@keyframes stepIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Fields / inputs */

.field {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;

  label {
    font-size: var(--fs-sm);
    font-weight: 500;
    color: var(--c-muted-strong);
  }
}

.control {
  width: 100%;
  border-radius: var(--radius);
  border: 1px solid var(--c-border);
  background-color: #fff;
  padding: 0.65rem 0.8rem;
  font-size: var(--fs-base);
  line-height: 1.3;
  color: var(--c-text);
  transition:
    border-color 0.15s ease,
    box-shadow 0.15s ease,
    background-color 0.15s ease;

  &::placeholder {
    color: var(--c-muted);
  }

  &:focus-visible {
    outline: 2px solid color-mix(in oklab, var(--c-primary) 80%, #fff 20%);
    outline-offset: 1px;
    border-color: var(--c-primary);
    box-shadow: 0 0 0 1px color-mix(in oklab, var(--c-primary) 70%, #fff 30%);
    background-color: #fff;
  }
}

.select {
  padding-right: 2.25rem;
  background-image: linear-gradient(
      45deg,
      transparent 50%,
      var(--c-muted) 50%
    ),
    linear-gradient(135deg, var(--c-muted) 50%, transparent 50%);
  background-position:
    calc(100% - 1.15rem) 50%,
    calc(100% - 0.65rem) 50%;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  appearance: none;
}

/* Hint text */

.hint {
  font-size: var(--fs-xs);
  color: var(--c-muted);
  line-height: 1.4;
}

/* Radios */

.radioGroup {
  display: flex;
  flex-direction: column;
  gap: var(--sp-2);
}

.radio {
  display: flex;
  align-items: flex-start;
  gap: var(--sp-2);
  padding: var(--sp-3);
  border-radius: var(--radius);
  border: 1px solid var(--c-border);
  background-color: #fff;
  cursor: pointer;
  transition:
    border-color 0.15s ease,
    background-color 0.15s ease,
    box-shadow 0.15s ease;

  input {
    margin-top: 0.2rem;
    accent-color: var(--c-primary);
  }

  span {
    font-size: var(--fs-sm);
    color: var(--c-text);

    strong {
      display: block;
      color: var(--c-muted-strong);
      margin-bottom: 0.1rem;
    }

    small {
      font-size: var(--fs-xs);
      color: var(--c-muted);
    }
  }

  &:hover {
    border-color: var(--c-primary);
    background-color: var(--c-primary-soft);
    box-shadow: var(--shadow-xs);
  }

  &:has(input:focus-visible) {
    outline: 2px solid var(--c-primary);
    outline-offset: 2px;
  }

  &:has(input:checked) {
    border-color: var(--c-primary);
    box-shadow: var(--shadow-xs);
    background-color: var(--c-primary-soft);
  }

  input:checked + span {
    color: var(--c-primary-strong);

    strong {
      color: var(--c-primary-strong);
    }
  }
}

/* Messages */

.error {
  margin: 0;
  padding: var(--sp-2) var(--sp-3);
  border-radius: var(--radius-sm);
  border: 1px solid var(--c-error-border);
  background-color: var(--c-error-soft);
  font-size: var(--fs-sm);
  color: var(--c-error-text);
}

.note {
  margin: 0;
  padding: var(--sp-2) var(--sp-3);
  border-radius: var(--radius-sm);
  border: 1px dashed var(--c-border-strong);
  background-color: var(--c-step-bg);
  font-size: var(--fs-sm);
  color: var(--c-muted-strong);
}

/* Step controls (navigation buttons) */

.stepControls {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-2);
  margin-top: var(--sp-4);
}

.primaryBtn,
.secondaryBtn {
  @include p.btn;
  min-height: 2.75rem;
  padding-inline: var(--sp-4);
  font-size: var(--fs-sm);
}

.primaryBtn {
  background-color: var(--c-primary);
  border-color: var(--c-primary);
  color: #fff;

  &:hover:not(:disabled) {
    background-color: color-mix(in oklab, var(--c-primary) 90%, #fff 10%);
    border-color: color-mix(in oklab, var(--c-primary) 90%, #fff 10%);
  }

  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

.secondaryBtn {
  background-color: #fff;
  color: var(--c-muted-strong);
  border-color: var(--c-border);

  &:hover {
    background-color: var(--c-call-soft);
    border-color: var(--c-call);
  }
}

/* Summary card (step 3) */

.totalCard {
  border-radius: var(--radius-lg);
  border: 1px solid var(--c-border);
  background: radial-gradient(circle at top left, #ffffff 0, var(--c-step-bg) 55%);
  padding: var(--sp-4);
  box-shadow: var(--shadow-sm);
  display: flex;
  flex-direction: column;
  gap: var(--sp-3);
}

.rows {
  display: flex;
  flex-direction: column;
  gap: var(--sp-2);
}

.row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: var(--sp-2);
  font-size: var(--fs-sm);
}

.muted {
  color: var(--c-muted);
}

.amount {
  font-variant-numeric: tabular-nums;
  font-weight: 600;
}

.grand {
  font-size: var(--fs-lg);
  font-weight: 700;
  color: var(--c-primary-strong);
}

/* Desktop actions in summary */

.actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-2);
  margin-top: var(--sp-3);

  button,
  a {
    @include p.btn;
    flex: 1 1 0;
    justify-content: center;
    font-size: var(--fs-sm);
  }

  button {
    background-color: var(--c-whatsapp);
    border-color: var(--c-whatsapp);
    color: #fff;

    &:hover:not(:disabled) {
      background-color: color-mix(in oklab, var(--c-whatsapp) 92%, #fff 8%);
      border-color: color-mix(in oklab, var(--c-whatsapp) 92%, #fff 8%);
    }

    &:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  }

  a {
    background-color: #fff;
    color: var(--c-call);
    border-color: var(--c-border);

    &:hover {
      background-color: var(--c-call-soft);
      border-color: var(--c-call);
    }
  }
}

/* Disclaimer */

.disclaimer {
  margin: var(--sp-3) 0 0;
  padding-top: var(--sp-3);
  border-top: 1px solid var(--c-border);
  font-size: var(--fs-xs);
  line-height: var(--lh-normal);
  color: var(--c-muted);
}

/* Sticky CTA bar (mobile wizard) */

@media (max-width: 767px) {
  .stepBody {
    padding-bottom: var(--sp-6);
  }

  .stepControls {
    position: sticky;
    bottom: 0;
    margin-inline: calc(var(--sp-3) * -1);
    padding: var(--sp-3) var(--sp-3)
      calc(env(safe-area-inset-bottom, 0px) + var(--sp-3));
    background: linear-gradient(
      to top,
      rgba(255, 255, 255, 0.98),
      rgba(255, 255, 255, 0.9)
    );
    box-shadow: 0 -4px 12px rgba(15, 23, 42, 0.12);
    z-index: 5;
    gap: var(--sp-2);
  }

  .primaryBtn,
  .secondaryBtn {
    flex: 1 1 100%;
    width: 100%;
    justify-content: center;
  }

  .totalCard {
    margin-bottom: var(--sp-2);
  }

  .actions {
    flex-direction: column;

    button,
    a {
      flex: 1 1 100%;
    }
  }
}

/* Desktop refinements */

@media (min-width: 768px) {
  .form {
    padding-inline: var(--sp-6);
  }

  .stepControls {
    position: static;
    margin-inline: 0;
    padding: 0;
    background: transparent;
    box-shadow: none;

    .primaryBtn {
      flex: 0 0 auto;
    }

    .secondaryBtn {
      flex: 0 0 auto;
    }
  }
}
